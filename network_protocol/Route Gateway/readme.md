## 路由网关
路由器是一台设
备，它有五个网口或者网卡，相当于有五只手，分别连着五个局域网。每只手的 IP 地址都和局域网的 IP
地址相同的网段，每只手都是它握住的那个局域网的网关。

这个时候，问题来了，该选择哪一只手？IP 头和 MAC 头加什么内容，哪些变、哪些不变呢？这个问题
比较复杂，大致可以分为两类，一个是静态路由，一个是动态路由。动态路由下一节我们详细地讲。这
一节我们先说静态路由。

### 静态网关
静态路由，其实就是在路由器上，配置一条一条规则。这些规则包括：想访问 BBS 站（它肯定有个网
段），从 2 号口出去，下一跳是 IP2；想访问教学视频站（它也有个自己的网段），从 3 号口出去，下
一跳是 IP3，然后保存在路由器里。
每当要选择从哪只手抛出去的时候，就一条一条的匹配规则，找到符合的规则，就按规则中设置的那
样，从某个口抛出去，找下一跳 IPX。

不改变 IP 地址的网关，我们称为转发网关；改变 IP 地址的网关，我们称为NAT 网关。

#### 路由配置策略
静态路由可以用 ip rule add 命令静态配置路由规则和权重

### 动态路由算法
无论是一个国家内部，还是国家之间，我们都可以将复杂的路径，抽象为一种叫作图的数据结构。至于
唐僧西行取经，肯定想走得路越少越好，道路越短越好，因而这就转化成为如何在途中找到最短路径的问题。  
咱们在大学里面学习计算机网络与数据结构的时候，知道求最短路径常用的有两种方法，一种是
Bellman-Ford 算法，一种是 Dijkstra 算法。在计算机网络中基本也是用这两种方法计算的。

#### 距离矢量算法
第一大类的算法称为距离矢量路由（distance vector routing）。它是基于 Bellman-Ford 算法的。
这种算法的基本思路是，每个路由器都保存一个路由表，包含多行，每行对应网络中的一个路由器，每
一行包含两部分信息，一个是要到目标路由器，从那条线出去，另一个是到目标路由器的距离。
由此可以看出，每个路由器都是知道全局信息的。那这个信息如何更新呢？每个路由器都知道自己和邻
居之间的距离，每过几秒，每个路由器都将自己所知的到达所有的路由器的距离告知邻居，每个路由器
也能从邻居那里得到相似的信息。
每个路由器根据新收集的信息，计算和其他路由器的距离，比如自己的一个邻居距离目标路由器的距离
是 M，而自己距离邻居是 x，则自己距离目标路由器是 x+M。

#### 链路状态路由算法
第二大类算法是链路状态路由（link state routing），基于 Dijkstra 算法。
这种算法的基本思路是：当一个路由器启动的时候，首先是发现邻居，向邻居 say hello，邻居都回复。
然后计算和邻居的距离，发送一个 echo，要求马上返回，除以二就是距离。然后将自己和邻居之间的链
路状态包广播出去，发送到整个网络的每个路由器。这样每个路由器都能够收到它和邻居之间的关系的
信息。因而，每个路由器都能在自己本地构建一个完整的图，然后针对这个图使用 Dijkstra 算法，找到
两点之间的最短路径。  
不像距离距离矢量路由协议那样，更新时发送整个路由表。链路状态路由协议只广播更新的或改变的网
络拓扑，这使得更新信息更小，节省了带宽和 CPU 利用率。而且一旦一个路由器挂了，它的邻居都会广
播这个消息，可以使得坏消息迅速收敛。

### 动态路由协议
#### 基于链路状态路由算法的 OSPF
OSPF（Open Shortest Path First，开放式最短路径优先）就是这样一个基于链路状态路由协议，广泛
应用在数据中心中的协议。由于主要用在数据中心内部，用于路由决策，因而称为内部网关协议
（Interior Gateway Protocol，简称IGP）。

#### 基于距离矢量路由算法的 BGP
但是外网的路由协议，也即国家之间的，又有所不同。我们称为外网路由协议（Border Gateway
Protocol，简称BGP）